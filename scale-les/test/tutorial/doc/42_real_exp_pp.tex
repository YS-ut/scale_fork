
%-------------------------------------------------------%
\section{地形・土地利用データの作成：pp}
%-------------------------------------------------------%

ppディレクトリへ移動し、現実実験のための地形データ、土地利用データを作成する。
\begin{verbatim}
 $ cd ${Tutrial_DIR}/real/pp
\end{verbatim}
ppディレクトリの中には，\verb|pp.conf|という名前の
コンフィグファイルが準備されている．
ドメインの位置や格子点数など、実験設定に合わせて，
適宜\verb|pp.conf|を編集する必要があるが,
チュートリアルでは，すでに編集済みの\verb|pp.conf|が
与えられているためそのまま利用する．
\verb|pp.conf|の設定の中で特に注意するべき項目は，\verb|PARAM_CONVERT|である．
\begin{verbatim}
 &PARAM_CONVERT
  CONVERT_TOPO = .true.,
  CONVERT_LANDUSE = .true.,
 /
\end{verbatim}
上記のように\verb|CONVERT_TOPO|と\verb|CONVERT_LANDUSE|が
\verb|.true.|となっていることが，
それぞれ地形と土地利用の処理を行うことを意味している．
詳細なコンフィグファイルの内容については，
Appendix \ref{app:namelist}を参照されたい．

次に，コンパイル済みのバイナリと入力データをppディレクトリへリンクする．
\begin{verbatim}
 $ ln -s ../../bin/scale-les_pp ./
 $ ln -s ${SCALE_DB}/topo    ./
 $ ln -s ${SCALE_DB}/landuse ./
\end{verbatim}
今回は，Table \ref{tab:grids}に示されているように，
4つのMPIプロセスを使用する設定なので次のように実行する．
\begin{verbatim}
 $ mpirun -n 4 ./scale-les_pp pp.conf
\end{verbatim}
ジョブが正常に終了すれば，\verb|topo_d01.pe######.nc|と\verb|landuse_d01.pe######.nc|というファイルがMPIプロセス数だけ，つまり4つずつ生成される（\verb|######|にはMPIプロセスの番号が入る）．
それぞれ，ドメインの格子点に内挿された地形と土地利用の情報が入ってる.
実行時のログは、\verb|pp_LOG_d01.pe000000|に出力されるので内容を確かめておくこと．


%ノード毎に分割されたnetcdfを
%gradsで開けるバイナリーデータに変換するには、
%\label{sec:source_net2g}節でコンパイルした\verb|netcdf2grads_h|を使用する．
%\verb|netcdf2grads_h|の詳しい使用方法や\verb|net2g.conf|の詳細については、
%\label{sec:net2g}節を参照頂くこととして、
%ここでは、すでに用意されている \verb|quickview.sh|を使用する．

\vspace{1cm}
\noindent {\Large\em OPTION}\\
gpviewがインストールされていれば，次のコマンドによって
作成された地形と土地利用データが、正しく作成されているかどうか、
確認することが出来る．正しく作成されていれば，Fig. \ref{fig:domain}と同様の図ができる．
\begin{verbatim}
  $ gpview topo_d01.pe00000*@TOPO --aspect=1
  $ gpview landuse_d01.pe00000*@FRAC_LAND --aspect=1
\end{verbatim}

