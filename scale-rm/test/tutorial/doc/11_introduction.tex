\section{はじめに}
%==============================================================%

本書は初めて領域気象気候モデル(SCALE-RM)
を利用するユーザー向けに解説したユーザーズガイドです。
本書はSCALE-RM version \version に対応した説明になっています。
第\ref{sec:overview}章でSCALEの概要について説明し、
第\ref{sec:install}章で必要な環境、およびインストール方法を説明します。
続いて、第\ref{sec:tuto_ideal}章で理想実験、
第\ref{sec:tuto_real}章で現実大気実験の実行方法について
簡単な例を示しながら説明します。
第\ref{sec:install}章から第\ref{sec:tuto_real}章までは
ひと繋がりのチュートリアルとなっており、
SCALE-RMを初めて使うユーザーは一通り通読することを勧めます。
第\ref{sec:basic}章以降は、設定の変更、機能やツールの説明が記載されています。

本書中の不明点やお気づきの点がございましたら、SCALE user's メーリングリスト\\
 \verb|scale-user@riken.jp|までご連絡ください。



\subsection{SCALEの特徴}
%--------------------------------------------------------------%

SCALE (Scalable Computing for Advanced Library and Environment)は
計算機を用いて気象・気候科学の問題にアプローチする際に、
ユーザーが研究を進めやすいように、
事前処理から数値計算、解析に至るまですべての過程を網羅する数値計算ライブラリを
目指したソフトウェアであり、下記に挙げるような特徴を持つ。
\begin{itemize}
\item SCALEは、「BSD-2ライセンス」のもとオープンソースソフトウェア
として提供されており、商用、非商用に関わらず自由な利用・改変・再配布が可能である。
\item SCALEには、SCALE-RM(SCALE-Regional Model)、
%SCALE-GM(SCALE-Global Model)
といった組み上げ済みの数値モデルが含まれている。
\item SCALEには、次節で説明する様々なコンポーネントが導入されており、
必要に応じて取り替えることが可能である。
\end{itemize}

ライセンスの詳細は、トップディレクトリ直下の``\verb|scale/LICENSE|''のファイルに記述されている。
SCALEの使用前に一読しておくこと。またSCALEのWebページにも説明が記載されているので必要に応じて
参照すること（\url{http://scale.aics.riken.jp/}）。



\subsection{SCALE-RMモデルの構成}
%--------------------------------------------------------------%
現在、SCALEには下記のコンポーネントが実装されている。
SCALE-RM ではすべてのコンポーネントが利用可能である。
詳細なモデル構成や差分化手法については、
\citet{scale_2015}、\citet{satoy_2015b}、
および\citet{nishizawa_2015}を参照されたい。\\


\noindent{\bf フレームワーク関係}
\begin{itemize}
 \item カーテシアン(Cartesian)グリッドシステム（Arakawa C-grid）
 \item MPI通信を用いた二次元領域分割
 \item 各種投影法(Map-projection \& Map-factors)
 \item ネスティングシステム（1-way：親→子のみ）
   \begin{itemize}
    \item オンライン実行(複数ドメインの計算を同時に実行)とオフライン実行(外側ドメインの計算終了後に、その結果を用いて内側ドメインの計算を行う)を選択可能
   \end{itemize}
 \item 複数事例一括実行 システム（バルクジョブシステム）
 \item gtoolベースnetcdf4ファイル I/O
 \item 外部データ読み込みによる初期値・境界値データ作成
   \begin{itemize}
    \item WRF-ARW、NICAM、その他GrADSフォーマットでの入力に対応
   \end{itemize}
\end{itemize}

{\bf 力学コア関係}
\begin{itemize}
 \item 方程式系: 3次元完全圧縮非静力学方程式系
 \item 数値解法: 陽解法と陰解法の両方を実装
   \begin{itemize}
    \item HE-VE(陽解法)
    \item HE-VI(水平方向は陽解法-鉛直方向は陰解法)
%    \item HI-VI(陰解法)
   \end{itemize}
 \item 空間差分:
    \begin{itemize}
      \item 2次中央差分(2-nd order central difference schemes)
      \item 4次中央差分(4-th order central difference schemes)
      \item 6次中央差分(6-th order central difference schemes)
      \item 3次風上差分(3-rd order upwind difference schemes)
%      \item 3次風上差分（Koren(1993)filterあり）(3rd order upwind difference scheme with \citet{Koren_1993} filter)
      \item 5次風上差分(5-th order upwind difference schemes)
    \end{itemize}
 \item 時間差分:
    \begin{itemize}
      \item 3次ルンゲクッタスキーム(Heun's 3rd order Runge-Kutta scheme)
      \item Wicker and Skamarock (2002) 3段ルンゲクッタスキーム \citep[3-step Runge-Kutta scheme of ][]{Wicker_2002}
      \item 4次ルンゲクッタスキーム(4th order Runge-Kutta scheme)
    \end{itemize}
 \item 非負保証:
    \begin{itemize}
      \item フラックス修正法(Flux Corrected Transport)
      \item Koren (1993) filter \citep{Koren_1993} (3次風上差分スキーム使用時のみ)
    \end{itemize}
 \item 数値フィルター: 4次超粘性(4-th Hyper diffusion)
 \item 地形: 地形に沿った座標系(Terrain following coordinate)
\end{itemize}


{\bf 物理過程}
\begin{itemize}
 \item 乱流過程: 複数から選択可能
   \begin{itemize}
    \item Smagorinsky-Lilly typeのサブグリッドモデル \citep{smagorinsky_1963,lilly_1962,Brown_etal_1994,Scotti_1993}
    \item Deardorff(1980) サブグリットモデル \citep{Deardorff_1980}
    \item MYNN2.5境界層モデル \citep{my_1982,nakanishi_2004}
   \end{itemize}
 \item 雲微物理: 複数から選択可能
   \begin{itemize}
    \item Kessler type バルクモデル \citep{kessler_1969}
    \item 6-class single moment バルクモデル \citep{tomita_2008}
    \item 6-class double moment バルクモデル \citep{sn_2014}
    \item ビン法雲モデル \citep{suzuki_etal_2010}
   \end{itemize}
 \item 放射過程: MSTRN-X \citep{sekiguchi_2008}
 \item 地表面モデル
  \begin{itemize}
   \item 陸面モデル: 熱拡散・バケツモデル\\
         (バルク交換係数:\citep{beljaars_1991,wilson_2001}もしくは\citep{uno_1995})
   \item 海洋モデル:（スラブモデル）
   \item 都市モデル: 単層キャノピーモデル \citep{kusaka_2001}
  \end{itemize}
\end{itemize}

上記に加え、SCALE-RM のコンポーネントとして、
現実事例の計算に必要な地形や土地利用データを作成するツール、
理想実験の初期値・境界値、もしくは外部モデルから初期値・境界値を作成するツールが提供されている。

次節でSCALEの思想とモデルの関係について説明するが、
SCALE-RMの実行とは直接関係ないため、
必要なければ読み飛ばしても構わない。


\subsection{SCALEのライブラリとモデル}

\begin{figure}[bh]
\begin{center}
  \includegraphics[width=0.9\hsize]{./figure/library.eps}\\
  \caption{SCALEのねらい}
  \label{fig:scale}
\end{center}
\end{figure}

SCALEは、理化学研究所 計算科学研究機構（RIKEN AICS）を中心に
開発が進められている気象・気候科学計算向けのライブラリである。
図 \ref{fig:scale}にSCALEの思想の概念図を示す。
この図に示されるような諸問題に対応することを目指している。
具体的には、
SCALEは次世代のスーパーコンピュータから小型PCクラスターに至るまで
広く用いられる事を念頭において開発されており、
気候・気象科学を専門とする科学者と計算機科学を専門とする科学者が
共同で開発を行っている。
そのため、スーパーコンピュータ「京」やFujitsu FX10等の
スーパーコンピュータ上でも、
高い計算効率がでるように設計されている。
ユーザーには、スーパーコンピュータ「京」を
はじめとする並列計算機に対してチューニングされた
モデルコンポーネントや解析システム、テストセット、
そして「開発環境」を提供する。

SCALEを利用した数値モデルとして、
SCALE-RMが含まれている(図 \ref{fig:scale-rm})。
格子系、力学コア、各種物理過程などの基本的なコンポーネントは
SCALEが提供する。
SCALE-RM は、予報変数などをコンテナを持ち、
SCALEのコンポーネントを適切に呼び出すことで時間発展計算を行っている。
ユーザーは、必要に応じて、各コンポーネントを選択し、
組み合わせて使用することが可能である。
このSCALE-RMを気象研究に適用した事例には
\citet{satoy_2014}、\citet{satoy_2015}がある。
%ユーザーは、SCALEを用いてSCALE-RMと同様な方法によって
%新たなモデル作ることができる。


\begin{figure}[tb]
\begin{center}
  \includegraphics[width=0.9\hsize]{./figure/scale.eps}\\
  \caption{SCALEとSCALE-RMの関係}
  \label{fig:scale-rm}
\end{center}
\end{figure}


